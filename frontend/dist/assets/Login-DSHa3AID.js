import{_ as N,r as p,a as k,c as h,b as l,w as r,d as n,u as A,o as M,e as i,f as $,g as C,h as c,i as z,E as v}from"./index-C5MahtCV.js";import{l as I,r as S}from"./api-C5N3iWI4.js";const T={class:"login-container"},j={class:"test-accounts"},D={__name:"Login",setup(G){const R=A(),{setAuth:P}=z(),_=p(null),f=p(null),b=p(!1),y=p(!1),m=p(!1),u=k({username:"",password:""}),s=k({username:"",password:"",confirmPassword:""}),U={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6个字符",trigger:"blur"}]},F={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名至少3个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(o,e,t)=>{e!==s.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]},g=async()=>{_.value&&await _.value.validate(async o=>{if(o){b.value=!0;try{const e=await I({username:u.username,password:u.password});P(e.token,e.username),v.success("登录成功"),R.push("/")}catch(e){v.error(e.message||"登录失败")}finally{b.value=!1}}})},q=async()=>{f.value&&await f.value.validate(async o=>{if(o){y.value=!0;try{await S({username:s.username,password:s.password}),v.success("注册成功，请登录"),m.value=!1,V()}catch(e){v.error(e.message||"注册失败")}finally{y.value=!1}}})},V=()=>{var o;s.username="",s.password="",s.confirmPassword="",(o=f.value)==null||o.clearValidate()};return(o,e)=>{const t=n("el-input"),d=n("el-form-item"),w=n("el-button"),x=n("el-form"),L=n("el-divider"),E=n("el-text"),B=n("el-card"),K=n("el-dialog");return M(),h("div",T,[l(B,{class:"login-card"},{header:r(()=>[...e[8]||(e[8]=[i("div",{class:"card-header"},[i("h2",null,"短信模板生成系统"),i("p",{class:"subtitle"},"账号密码登录")],-1)])]),default:r(()=>[l(x,{ref_key:"loginFormRef",ref:_,model:u,rules:U,"label-width":"80px",onSubmit:$(g,["prevent"])},{default:r(()=>[l(d,{label:"用户名",prop:"username"},{default:r(()=>[l(t,{modelValue:u.username,"onUpdate:modelValue":e[0]||(e[0]=a=>u.username=a),placeholder:"请输入用户名","prefix-icon":"User",clearable:"",onKeyup:C(g,["enter"])},null,8,["modelValue"])]),_:1}),l(d,{label:"密码",prop:"password"},{default:r(()=>[l(t,{modelValue:u.password,"onUpdate:modelValue":e[1]||(e[1]=a=>u.password=a),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":"",clearable:"",onKeyup:C(g,["enter"])},null,8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(w,{type:"primary",loading:b.value,onClick:g,style:{width:"100%"}},{default:r(()=>[...e[9]||(e[9]=[c(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1}),l(d,null,{default:r(()=>[l(w,{link:"",type:"primary",onClick:e[2]||(e[2]=a=>m.value=!0),style:{width:"100%"}},{default:r(()=>[...e[10]||(e[10]=[c(" 还没有账号？立即注册 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),l(L,null,{default:r(()=>[...e[11]||(e[11]=[i("span",{class:"divider-text"},"测试账号",-1)])]),_:1}),i("div",j,[l(E,{type:"info",size:"small"},{default:r(()=>[...e[12]||(e[12]=[i("p",null,"管理员: admin / admin123",-1),i("p",null,"普通用户: user / user123",-1)])]),_:1})])]),_:1}),l(K,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),title:"用户注册",width:"400px",onClose:V},{footer:r(()=>[l(w,{onClick:e[6]||(e[6]=a=>m.value=!1)},{default:r(()=>[...e[13]||(e[13]=[c("取消",-1)])]),_:1}),l(w,{type:"primary",loading:y.value,onClick:q},{default:r(()=>[...e[14]||(e[14]=[c(" 注册 ",-1)])]),_:1},8,["loading"])]),default:r(()=>[l(x,{ref_key:"registerFormRef",ref:f,model:s,rules:F,"label-width":"80px"},{default:r(()=>[l(d,{label:"用户名",prop:"username"},{default:r(()=>[l(t,{modelValue:s.username,"onUpdate:modelValue":e[3]||(e[3]=a=>s.username=a),placeholder:"至少3个字符",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"密码",prop:"password"},{default:r(()=>[l(t,{modelValue:s.password,"onUpdate:modelValue":e[4]||(e[4]=a=>s.password=a),type:"password",placeholder:"至少6个字符","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"确认密码",prop:"confirmPassword"},{default:r(()=>[l(t,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>s.confirmPassword=a),type:"password",placeholder:"请再次输入密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Q=N(D,[["__scopeId","data-v-242ef00e"]]);export{Q as default};
