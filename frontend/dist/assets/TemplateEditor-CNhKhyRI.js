import{_ as ne,a as le,r as b,j as se,c as $,b as n,k as v,l as z,w as t,d as c,o as r,e as _,h as d,F as L,m as j,t as x,g as ae,n as de,p as ce,E as f}from"./index-D6e3W3Mj.js";import{g as ue,a as ie,b as re}from"./api-B90yl-sG.js";const pe={class:"template-editor"},me={class:"form-tip"},_e={class:"speech-group-selector"},fe={class:"form-tip"},ge={class:"card-header"},ve={style:{display:"flex","align-items":"center",gap:"15px"}},be={class:"content-cell"},xe={key:1},ye={__name:"TemplateEditor",setup(Ce){const s=le({encoding:"Unicode",generateMode:"sequential",selectedPositions:[],positions:{a:[],b:[],c:[],d:[]},speechGroups:{}}),U=b(!1),g=b([]),E=b(0),V=b(0),y=b(-1),C=b(""),G=b([]),A=async()=>{try{const o=await ue();o.positions&&(s.positions={a:o.positions.a||[],b:o.positions.b||[],c:o.positions.c||[],d:o.positions.d||[]})}catch(o){console.error("加载位置配置失败:",o)}},D=async()=>{try{const o=await ie();G.value=o.groups||[]}catch(o){console.error("加载话术组失败:",o)}},N=o=>{var l;const e=G.value.find(i=>i.name===o);return e&&((l=e.speeches)==null?void 0:l.length)||0},R=async()=>{if(s.selectedPositions.length===0){f.warning("请至少选择一个位置");return}for(const o of s.selectedPositions){const e=s.positions[o]&&s.positions[o].length>0,l=s.speechGroups[o];if(!e&&!l){f.warning(`位置 ${o.toUpperCase()} 没有配置值或话术组，请先配置`);return}}U.value=!0;try{const o={encoding:s.encoding,generateMode:s.generateMode,positions:s.positions,selectedPositions:s.selectedPositions,speechGroups:s.speechGroups},e=await re(o);g.value=e.results.map((l,i)=>({...l,index:i})),E.value=e.totalCount,V.value=e.exceededCount,e.exceededCount>0?f.warning(`生成了 ${e.totalCount} 条内容，其中 ${e.exceededCount} 条超出字符限制`):f.success(`成功生成 ${e.totalCount} 条内容`)}catch(o){f.error(o.message||"生成失败")}finally{U.value=!1}},q=()=>{s.selectedPositions=["a","b","c","d"],s.encoding="Unicode",s.generateMode="sequential",s.speechGroups={},g.value=[],E.value=0,V.value=0},O=o=>{y.value=o.index,C.value=o.content},S=o=>{y.value===o.index&&(o.content=C.value,o.charCount=C.value.length,o.isExceeded=o.charCount>70,o.exceededChars=o.isExceeded?o.charCount-70:0,y.value=-1,f.success("保存成功"))},K=o=>{if(g.value.length===0){f.warning("没有可导出的数据");return}const l=`短信内容_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}`;switch(o){case"txt":X(l);break;case"csv":Z(l);break;case"excel":H(l);break}},X=o=>{let e=`短信内容生成结果
`;e+=`生成时间: ${new Date().toLocaleString("zh-CN")}
`,e+=`总计: ${E.value} 条
`,e+=`超出限制: ${V.value} 条
`,e+=`
${"=".repeat(50)}

`,g.value.forEach((l,i)=>{e+=`${i+1}. ${l.content}
`,e+=`   字符数: ${l.charCount}`,l.isExceeded&&(e+=` (超出 ${l.exceededChars} 字符)`),e+=`

`}),P(e,`${o}.txt`,"text/plain;charset=utf-8"),f.success("导出成功")},Z=o=>{let e=`\uFEFF序号,内容,字符数,是否超出,超出字符数
`;g.value.forEach((l,i)=>{const u=[i+1,`"${l.content.replace(/"/g,'""')}"`,l.charCount,l.isExceeded?"是":"否",l.exceededChars];e+=u.join(",")+`
`}),P(e,`${o}.csv`,"text/csv;charset=utf-8"),f.success("导出成功")},H=o=>{let e=`\uFEFF序号	内容	字符数	是否超出	超出字符数
`;g.value.forEach((l,i)=>{const u=[i+1,l.content,l.charCount,l.isExceeded?"是":"否",l.exceededChars];e+=u.join("	")+`
`}),P(e,`${o}.xls`,"application/vnd.ms-excel;charset=utf-8"),f.success("导出成功")},P=(o,e,l)=>{const i=new Blob([o],{type:l}),u=URL.createObjectURL(i),p=document.createElement("a");p.href=u,p.download=e,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(u)};return se(()=>{A(),D()}),(o,e)=>{const l=c("el-checkbox"),i=c("el-checkbox-group"),u=c("el-text"),p=c("el-form-item"),h=c("el-option"),F=c("el-select"),B=c("el-radio"),J=c("el-radio-group"),k=c("el-button"),Q=c("el-form"),M=c("el-card"),W=c("el-icon"),T=c("el-dropdown-item"),Y=c("el-dropdown-menu"),ee=c("el-dropdown"),te=c("el-input"),w=c("el-table-column"),I=c("el-tag"),oe=c("el-table");return r(),$("div",pe,[n(M,{class:"editor-card"},{header:t(()=>[...e[4]||(e[4]=[_("div",{class:"card-header"},[_("span",null,"内容生成")],-1)])]),default:t(()=>[n(Q,{model:s,"label-width":"120px"},{default:t(()=>[n(p,{label:"选择位置"},{default:t(()=>[n(i,{modelValue:s.selectedPositions,"onUpdate:modelValue":e[0]||(e[0]=a=>s.selectedPositions=a)},{default:t(()=>[n(l,{label:"a"},{default:t(()=>[...e[5]||(e[5]=[d("位置 A",-1)])]),_:1}),n(l,{label:"b"},{default:t(()=>[...e[6]||(e[6]=[d("位置 B",-1)])]),_:1}),n(l,{label:"c"},{default:t(()=>[...e[7]||(e[7]=[d("位置 C",-1)])]),_:1}),n(l,{label:"d"},{default:t(()=>[...e[8]||(e[8]=[d("位置 D",-1)])]),_:1})]),_:1},8,["modelValue"]),_("div",me,[n(u,{type:"info",size:"small"},{default:t(()=>[...e[9]||(e[9]=[d(" 至少选择一个位置，系统将根据位置配置和话术组生成内容 ",-1)])]),_:1})])]),_:1}),n(p,{label:"话术组选择"},{default:t(()=>[_("div",_e,[(r(),$(L,null,j(["a","b","c","d"],a=>_("div",{key:a,class:"speech-group-item"},[n(u,{size:"small"},{default:t(()=>[d("位置 "+x(a.toUpperCase())+":",1)]),_:2},1024),n(F,{modelValue:s.speechGroups[a],"onUpdate:modelValue":m=>s.speechGroups[a]=m,placeholder:"选择话术组（可选）",clearable:"",style:{width:"200px","margin-left":"10px"}},{default:t(()=>[(r(!0),$(L,null,j(G.value,m=>(r(),v(h,{key:m.id,label:m.name,value:m.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"]),s.speechGroups[a]?(r(),v(u,{key:0,type:"success",size:"small",style:{"margin-left":"10px"}},{default:t(()=>[d(" ("+x(N(s.speechGroups[a]))+" 条话术) ",1)]),_:2},1024)):z("",!0)])),64))]),_("div",fe,[n(u,{type:"info",size:"small"},{default:t(()=>[...e[10]||(e[10]=[d(" 如果为位置选择了话术组，将使用话术组的内容；否则使用位置配置的值 ",-1)])]),_:1})])]),_:1}),n(p,{label:"字符编码"},{default:t(()=>[n(F,{modelValue:s.encoding,"onUpdate:modelValue":e[1]||(e[1]=a=>s.encoding=a),placeholder:"请选择编码"},{default:t(()=>[n(h,{label:"ASCII",value:"ASCII"}),n(h,{label:"Zawgyi",value:"Zawgyi"}),n(h,{label:"Unicode",value:"Unicode"}),n(h,{label:"其它",value:"Other"})]),_:1},8,["modelValue"])]),_:1}),n(p,{label:"生成方式"},{default:t(()=>[n(J,{modelValue:s.generateMode,"onUpdate:modelValue":e[2]||(e[2]=a=>s.generateMode=a)},{default:t(()=>[n(B,{label:"sequential"},{default:t(()=>[...e[11]||(e[11]=[d("顺序生成",-1)])]),_:1}),n(B,{label:"random"},{default:t(()=>[...e[12]||(e[12]=[d("随机生成",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(p,null,{default:t(()=>[n(k,{type:"primary",onClick:R,loading:U.value,disabled:s.selectedPositions.length===0},{default:t(()=>[...e[13]||(e[13]=[d(" 生成内容 ",-1)])]),_:1},8,["loading","disabled"]),n(k,{onClick:q},{default:t(()=>[...e[14]||(e[14]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),g.value.length>0?(r(),v(M,{key:0,class:"results-card"},{header:t(()=>[_("div",ge,[e[20]||(e[20]=_("span",null,"生成结果",-1)),_("div",ve,[n(u,{type:"info",size:"small"},{default:t(()=>[d(" 总计: "+x(E.value)+" 条 | 超出: ",1),n(u,{type:"danger"},{default:t(()=>[d(x(V.value),1)]),_:1}),e[15]||(e[15]=d(" 条 ",-1))]),_:1}),n(ee,{onCommand:K,trigger:"click"},{dropdown:t(()=>[n(Y,null,{default:t(()=>[n(T,{command:"txt"},{default:t(()=>[...e[17]||(e[17]=[d("导出为 TXT",-1)])]),_:1}),n(T,{command:"csv"},{default:t(()=>[...e[18]||(e[18]=[d("导出为 CSV",-1)])]),_:1}),n(T,{command:"excel"},{default:t(()=>[...e[19]||(e[19]=[d("导出为 Excel",-1)])]),_:1})]),_:1})]),default:t(()=>[n(k,{type:"primary"},{default:t(()=>[e[16]||(e[16]=d(" 导出 ",-1)),n(W,{class:"el-icon--right"},{default:t(()=>[n(de(ce))]),_:1})]),_:1})]),_:1})])])]),default:t(()=>[n(oe,{data:g.value,stripe:"",style:{width:"100%"}},{default:t(()=>[n(w,{prop:"content",label:"内容","min-width":"300"},{default:t(({row:a})=>[_("div",be,[y.value===a.index?(r(),v(te,{key:0,modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=m=>C.value=m),onBlur:m=>S(a),onKeyup:ae(m=>S(a),["enter"]),autofocus:""},null,8,["modelValue","onBlur","onKeyup"])):(r(),$("span",xe,x(a.content),1))])]),_:1}),n(w,{prop:"charCount",label:"字符数",width:"100",align:"center"},{default:t(({row:a})=>[n(u,{type:a.isExceeded?"danger":"success"},{default:t(()=>[d(x(a.charCount),1)]),_:2},1032,["type"])]),_:1}),n(w,{label:"状态",width:"120",align:"center"},{default:t(({row:a})=>[a.isExceeded?(r(),v(I,{key:0,type:"danger"},{default:t(()=>[d(" 超出 "+x(a.exceededChars)+" 字符 ",1)]),_:2},1024)):(r(),v(I,{key:1,type:"success"},{default:t(()=>[...e[21]||(e[21]=[d("正常",-1)])]),_:1}))]),_:1}),n(w,{label:"操作",width:"100",align:"center"},{default:t(({row:a})=>[y.value!==a.index?(r(),v(k,{key:0,link:"",type:"primary",onClick:m=>O(a)},{default:t(()=>[...e[22]||(e[22]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"])):(r(),v(k,{key:1,link:"",type:"success",onClick:m=>S(a)},{default:t(()=>[...e[23]||(e[23]=[d(" 保存 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):z("",!0)])}}},Ee=ne(ye,[["__scopeId","data-v-14cb7cce"]]);export{Ee as default};
