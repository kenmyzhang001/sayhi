import{_ as H,r as u,a as J,j as O,c as E,b as t,w as s,d as r,E as p,v as P,o as v,x as Q,k as F,h as i,t as _,e as y,g as W,F as X,m as Y,s as Z}from"./index-D6e3W3Mj.js";import{a as ee,e as le,u as te,f as ae}from"./api-B90yl-sG.js";const se={class:"speech-groups"},oe={class:"card-header"},ne={class:"speeches-editor"},re={class:"speeches-list"},ie={__name:"SpeechGroups",setup(de){const w=u(!1),b=u(!1),c=u(!1),x=u("新建话术组"),m=u(null),h=u(""),S=u([]),g=u(null),a=J({name:"",description:"",speeches:[]}),$={name:[{required:!0,message:"请输入话术组名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],speeches:[{required:!0,message:"至少添加一条话术",trigger:"change"},{validator:(l,e,d)=>{!e||e.length===0?d(new Error("至少添加一条话术")):d()},trigger:"change"}]},V=async()=>{w.value=!0;try{const l=await ee();S.value=l.groups||[]}catch(l){p.error("加载失败: "+l.message)}finally{w.value=!1}},I=()=>{x.value="新建话术组",g.value=null,B(),c.value=!0},T=l=>{x.value="编辑话术组",g.value=l.id,a.name=l.name,a.description=l.description||"",a.speeches=[...l.speeches||[]],c.value=!0},U=async l=>{try{await Z.confirm(`确定要删除话术组 "${l.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await le(l.id),p.success("删除成功"),V()}catch(e){e!=="cancel"&&p.error("删除失败: "+e.message)}},M=()=>{var e;const l=h.value.trim();if(l){if(a.speeches.includes(l)){p.warning("该话术已存在");return}a.speeches.push(l),h.value="",(e=m.value)==null||e.validateField("speeches")}},N=l=>{var e;a.speeches.splice(l,1),(e=m.value)==null||e.validateField("speeches")},R=async()=>{m.value&&await m.value.validate(async l=>{if(l){b.value=!0;try{g.value?(await te(g.value,{name:a.name,description:a.description,speeches:a.speeches}),p.success("更新成功")):(await ae({name:a.name,description:a.description,speeches:a.speeches}),p.success("创建成功")),c.value=!1,V()}catch(e){p.error(e.message||"操作失败")}finally{b.value=!1}}})},j=()=>{var l;B(),(l=m.value)==null||l.clearValidate()},B=()=>{a.name="",a.description="",a.speeches=[],h.value=""};return O(()=>{V()}),(l,e)=>{const d=r("el-button"),f=r("el-table-column"),G=r("el-tag"),D=r("el-text"),q=r("el-table"),z=r("el-card"),k=r("el-input"),C=r("el-form-item"),A=r("el-form"),K=r("el-dialog"),L=P("loading");return v(),E("div",se,[t(z,null,{header:s(()=>[y("div",oe,[e[6]||(e[6]=y("span",null,"话术组管理",-1)),t(d,{type:"primary",onClick:I},{default:s(()=>[...e[5]||(e[5]=[i("新建话术组",-1)])]),_:1})])]),default:s(()=>[Q((v(),F(q,{data:S.value,stripe:"",style:{width:"100%"}},{default:s(()=>[t(f,{prop:"id",label:"ID",width:"80",align:"center"}),t(f,{prop:"name",label:"话术组名称","min-width":"150"}),t(f,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(f,{label:"话术数量",width:"120",align:"center"},{default:s(({row:o})=>[t(G,null,{default:s(()=>{var n;return[i(_(((n=o.speeches)==null?void 0:n.length)||0),1)]}),_:2},1024)]),_:1}),t(f,{label:"话术内容","min-width":"300","show-overflow-tooltip":""},{default:s(({row:o})=>[t(D,{type:"info",size:"small"},{default:s(()=>{var n;return[i(_(((n=o.speeches)==null?void 0:n.join(", "))||"无"),1)]}),_:2},1024)]),_:1}),t(f,{label:"操作",width:"200",align:"center",fixed:"right"},{default:s(({row:o})=>[t(d,{link:"",type:"primary",onClick:n=>T(o)},{default:s(()=>[...e[7]||(e[7]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(d,{link:"",type:"danger",onClick:n=>U(o)},{default:s(()=>[...e[8]||(e[8]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,w.value]])]),_:1}),t(K,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),title:x.value,width:"600px",onClose:j},{footer:s(()=>[t(d,{onClick:e[3]||(e[3]=o=>c.value=!1)},{default:s(()=>[...e[9]||(e[9]=[i("取消",-1)])]),_:1}),t(d,{type:"primary",loading:b.value,onClick:R},{default:s(()=>[...e[10]||(e[10]=[i(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[t(A,{ref_key:"formRef",ref:m,model:a,rules:$,"label-width":"100px"},{default:s(()=>[t(C,{label:"话术组名称",prop:"name"},{default:s(()=>[t(k,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.name=o),placeholder:"请输入话术组名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(C,{label:"描述",prop:"description"},{default:s(()=>[t(k,{modelValue:a.description,"onUpdate:modelValue":e[1]||(e[1]=o=>a.description=o),type:"textarea",rows:2,placeholder:"请输入描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(C,{label:"话术内容",prop:"speeches"},{default:s(()=>[y("div",ne,[t(k,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),placeholder:"输入话术后按回车添加",onKeyup:W(M,["enter"]),style:{"margin-bottom":"10px"}},null,8,["modelValue"]),y("div",re,[(v(!0),E(X,null,Y(a.speeches,(o,n)=>(v(),F(G,{key:n,closable:"",onClose:ue=>N(n),style:{"margin-right":"8px","margin-bottom":"8px"}},{default:s(()=>[i(_(o),1)]),_:2},1032,["onClose"]))),128))]),t(D,{type:"info",size:"small"},{default:s(()=>[i(" 共 "+_(a.speeches.length)+" 条话术 ",1)]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},me=H(ie,[["__scopeId","data-v-03230ef1"]]);export{me as default};
