import{_ as ne,a as se,r as x,j as ae,k as de,c as V,b as l,l as g,m as F,w as o,d as u,o as c,e as _,h as a,F as z,n as L,t as b,g as ie,p as ue,q as re,E as f}from"./index-DdXuyWcv.js";import{g as ce,a as pe,b as me}from"./api-DkB4YqrO.js";const fe={class:"template-editor"},_e={class:"form-tip"},ge={class:"speech-group-selector"},ve={class:"form-tip"},xe={class:"form-tip"},be={class:"card-header"},Ce={style:{display:"flex","align-items":"center",gap:"15px"}},ye={class:"content-cell"},he={key:1},ke={__name:"TemplateEditor",setup(Ve){const n=se({generateMode:"sequential",maxChars:70,selectedPositions:[],positions:{a:[],b:[],c:[],d:[],e:[],f:[],g:[],h:[],i:[],j:[]},speechGroups:{},encodings:{}}),U=x(!1),v=x([]),E=x(0),w=x(0),C=x(-1),y=x(""),P=x([]),q=async()=>{try{const t=await ce();t.positions&&(n.positions={a:t.positions.a||[],b:t.positions.b||[],c:t.positions.c||[],d:t.positions.d||[],e:t.positions.e||[],f:t.positions.f||[],g:t.positions.g||[],h:t.positions.h||[],i:t.positions.i||[],j:t.positions.j||[]})}catch(t){console.error("加载位置配置失败:",t)}},A=async()=>{try{const t=await pe();P.value=t.groups||[]}catch(t){console.error("加载话术组失败:",t)}},D=t=>{var s;const e=P.value.find(r=>r.name===t);return e&&((s=e.speeches)==null?void 0:s.length)||0},N=async()=>{if(n.selectedPositions.length===0){f.warning("请至少选择一个位置");return}for(const t of n.selectedPositions){const e=n.positions[t]&&n.positions[t].length>0,s=n.speechGroups[t];if(!e&&!s){f.warning(`位置 ${t.toUpperCase()} 没有配置值或话术组，请先配置`);return}if(!n.encodings[t]){f.warning(`位置 ${t.toUpperCase()} 未选择字符编码，请先选择`);return}}U.value=!0;try{const t={encodings:n.encodings,generateMode:n.generateMode,maxChars:n.maxChars||70,positions:n.positions,selectedPositions:n.selectedPositions,speechGroups:n.speechGroups},e=await me(t);v.value=e.results.map((s,r)=>({...s,index:r})),E.value=e.totalCount,w.value=e.exceededCount,e.exceededCount>0?f.warning(`生成了 ${e.totalCount} 条内容，其中 ${e.exceededCount} 条超出字符限制`):f.success(`成功生成 ${e.totalCount} 条内容`)}catch(t){f.error(t.message||"生成失败")}finally{U.value=!1}},R=()=>{n.selectedPositions=[],n.generateMode="sequential",n.maxChars=70,n.speechGroups={},n.encodings={},v.value=[],E.value=0,w.value=0},O=t=>{C.value=t.index,y.value=t.content},G=t=>{if(C.value===t.index){t.content=y.value;const e=n.maxChars||70;t.charCount=y.value.length,t.isExceeded=t.charCount>e,t.exceededChars=t.isExceeded?t.charCount-e:0,C.value=-1,f.success("保存成功")}},K=t=>{if(v.value.length===0){f.warning("没有可导出的数据");return}const s=`短信内容_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}`;switch(t){case"txt":X(s);break;case"csv":Z(s);break;case"excel":H(s);break}},X=t=>{let e=`短信内容生成结果
`;e+=`生成时间: ${new Date().toLocaleString("zh-CN")}
`,e+=`总计: ${E.value} 条
`,e+=`超出限制: ${w.value} 条
`,e+=`
${"=".repeat(50)}

`,v.value.forEach((s,r)=>{e+=`${r+1}. ${s.content}
`,e+=`   字符数: ${s.charCount}`,s.isExceeded&&(e+=` (超出 ${s.exceededChars} 字符)`),e+=`

`}),S(e,`${t}.txt`,"text/plain;charset=utf-8"),f.success("导出成功")},Z=t=>{let e=`\uFEFF序号,内容,字符数,是否超出,超出字符数
`;v.value.forEach((s,r)=>{const i=[r+1,`"${s.content.replace(/"/g,'""')}"`,s.charCount,s.isExceeded?"是":"否",s.exceededChars];e+=i.join(",")+`
`}),S(e,`${t}.csv`,"text/csv;charset=utf-8"),f.success("导出成功")},H=t=>{let e=`\uFEFF序号	内容	字符数	是否超出	超出字符数
`;v.value.forEach((s,r)=>{const i=[r+1,s.content,s.charCount,s.isExceeded?"是":"否",s.exceededChars];e+=i.join("	")+`
`}),S(e,`${t}.xls`,"application/vnd.ms-excel;charset=utf-8"),f.success("导出成功")},S=(t,e,s)=>{const r=new Blob([t],{type:s}),i=URL.createObjectURL(r),m=document.createElement("a");m.href=i,m.download=e,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(i)};return ae(()=>n.selectedPositions,(t,e)=>{t.filter(i=>!e.includes(i)).forEach(i=>{n.encodings[i]||(n.encodings[i]="Unicode")}),e.filter(i=>!t.includes(i)).forEach(i=>{delete n.encodings[i]})},{immediate:!1}),de(()=>{q(),A()}),(t,e)=>{const s=u("el-checkbox"),r=u("el-checkbox-group"),i=u("el-text"),m=u("el-form-item"),h=u("el-option"),j=u("el-select"),B=u("el-radio"),J=u("el-radio-group"),Q=u("el-input-number"),k=u("el-button"),W=u("el-form"),I=u("el-card"),Y=u("el-icon"),T=u("el-dropdown-item"),ee=u("el-dropdown-menu"),te=u("el-dropdown"),oe=u("el-input"),$=u("el-table-column"),M=u("el-tag"),le=u("el-table");return c(),V("div",fe,[l(I,{class:"editor-card"},{header:o(()=>[...e[4]||(e[4]=[_("div",{class:"card-header"},[_("span",null,"内容生成")],-1)])]),default:o(()=>[l(W,{model:n,"label-width":"120px"},{default:o(()=>[l(m,{label:"选择位置"},{default:o(()=>[l(r,{modelValue:n.selectedPositions,"onUpdate:modelValue":e[0]||(e[0]=d=>n.selectedPositions=d)},{default:o(()=>[l(s,{label:"a"},{default:o(()=>[...e[5]||(e[5]=[a("位置 A",-1)])]),_:1}),l(s,{label:"b"},{default:o(()=>[...e[6]||(e[6]=[a("位置 B",-1)])]),_:1}),l(s,{label:"c"},{default:o(()=>[...e[7]||(e[7]=[a("位置 C",-1)])]),_:1}),l(s,{label:"d"},{default:o(()=>[...e[8]||(e[8]=[a("位置 D",-1)])]),_:1}),l(s,{label:"e"},{default:o(()=>[...e[9]||(e[9]=[a("位置 E",-1)])]),_:1}),l(s,{label:"f"},{default:o(()=>[...e[10]||(e[10]=[a("位置 F",-1)])]),_:1}),l(s,{label:"g"},{default:o(()=>[...e[11]||(e[11]=[a("位置 G",-1)])]),_:1}),l(s,{label:"h"},{default:o(()=>[...e[12]||(e[12]=[a("位置 H",-1)])]),_:1}),l(s,{label:"i"},{default:o(()=>[...e[13]||(e[13]=[a("位置 I",-1)])]),_:1}),l(s,{label:"j"},{default:o(()=>[...e[14]||(e[14]=[a("位置 J",-1)])]),_:1})]),_:1},8,["modelValue"]),_("div",_e,[l(i,{type:"info",size:"small"},{default:o(()=>[...e[15]||(e[15]=[a(" 至少选择一个位置，系统将根据位置配置和话术组生成内容 ",-1)])]),_:1})])]),_:1}),n.selectedPositions.length>0?(c(),g(m,{key:0,label:"话术组与编码"},{default:o(()=>[_("div",ge,[(c(!0),V(z,null,L(n.selectedPositions,d=>(c(),V("div",{key:d,class:"speech-group-item"},[l(i,{size:"small"},{default:o(()=>[a("位置 "+b(d.toUpperCase())+":",1)]),_:2},1024),l(j,{modelValue:n.speechGroups[d],"onUpdate:modelValue":p=>n.speechGroups[d]=p,placeholder:"选择话术组（可选）",clearable:"",style:{width:"200px","margin-left":"10px"}},{default:o(()=>[(c(!0),V(z,null,L(P.value,p=>(c(),g(h,{key:p.id,label:p.name,value:p.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"]),n.speechGroups[d]?(c(),g(i,{key:0,type:"success",size:"small",style:{"margin-left":"10px"}},{default:o(()=>[a(" ("+b(D(n.speechGroups[d]))+" 条话术) ",1)]),_:2},1024)):F("",!0),l(j,{modelValue:n.encodings[d],"onUpdate:modelValue":p=>n.encodings[d]=p,placeholder:"选择编码",style:{width:"150px","margin-left":"15px"}},{default:o(()=>[l(h,{label:"ASCII",value:"ASCII"}),l(h,{label:"Zawgyi",value:"Zawgyi"}),l(h,{label:"Unicode",value:"Unicode"}),l(h,{label:"其它",value:"Other"})]),_:1},8,["modelValue","onUpdate:modelValue"])]))),128))]),_("div",ve,[l(i,{type:"info",size:"small"},{default:o(()=>[...e[16]||(e[16]=[a(" 如果为位置选择了话术组，将使用话术组的内容；否则使用位置配置的值。每个位置需要选择对应的字符编码。 ",-1)])]),_:1})])]),_:1})):F("",!0),l(m,{label:"生成方式"},{default:o(()=>[l(J,{modelValue:n.generateMode,"onUpdate:modelValue":e[1]||(e[1]=d=>n.generateMode=d)},{default:o(()=>[l(B,{label:"sequential"},{default:o(()=>[...e[17]||(e[17]=[a("顺序生成",-1)])]),_:1}),l(B,{label:"random"},{default:o(()=>[...e[18]||(e[18]=[a("随机生成",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"最大字符限制"},{default:o(()=>[l(Q,{modelValue:n.maxChars,"onUpdate:modelValue":e[2]||(e[2]=d=>n.maxChars=d),min:1,max:1e3,step:1,style:{width:"200px"},placeholder:"请输入最大字符数"},null,8,["modelValue"]),_("div",xe,[l(i,{type:"info",size:"small"},{default:o(()=>[...e[19]||(e[19]=[a(" 超过此字符数的内容将被标记为超出限制（默认：70） ",-1)])]),_:1})])]),_:1}),l(m,null,{default:o(()=>[l(k,{type:"primary",onClick:N,loading:U.value,disabled:n.selectedPositions.length===0},{default:o(()=>[...e[20]||(e[20]=[a(" 生成内容 ",-1)])]),_:1},8,["loading","disabled"]),l(k,{onClick:R},{default:o(()=>[...e[21]||(e[21]=[a("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),v.value.length>0?(c(),g(I,{key:0,class:"results-card"},{header:o(()=>[_("div",be,[e[27]||(e[27]=_("span",null,"生成结果",-1)),_("div",Ce,[l(i,{type:"info",size:"small"},{default:o(()=>[a(" 总计: "+b(E.value)+" 条 | 超出: ",1),l(i,{type:"danger"},{default:o(()=>[a(b(w.value),1)]),_:1}),e[22]||(e[22]=a(" 条 ",-1))]),_:1}),l(te,{onCommand:K,trigger:"click"},{dropdown:o(()=>[l(ee,null,{default:o(()=>[l(T,{command:"txt"},{default:o(()=>[...e[24]||(e[24]=[a("导出为 TXT",-1)])]),_:1}),l(T,{command:"csv"},{default:o(()=>[...e[25]||(e[25]=[a("导出为 CSV",-1)])]),_:1}),l(T,{command:"excel"},{default:o(()=>[...e[26]||(e[26]=[a("导出为 Excel",-1)])]),_:1})]),_:1})]),default:o(()=>[l(k,{type:"primary"},{default:o(()=>[e[23]||(e[23]=a(" 导出 ",-1)),l(Y,{class:"el-icon--right"},{default:o(()=>[l(ue(re))]),_:1})]),_:1})]),_:1})])])]),default:o(()=>[l(le,{data:v.value,stripe:"",style:{width:"100%"}},{default:o(()=>[l($,{prop:"content",label:"内容","min-width":"300"},{default:o(({row:d})=>[_("div",ye,[C.value===d.index?(c(),g(oe,{key:0,modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=p=>y.value=p),onBlur:p=>G(d),onKeyup:ie(p=>G(d),["enter"]),autofocus:""},null,8,["modelValue","onBlur","onKeyup"])):(c(),V("span",he,b(d.content),1))])]),_:1}),l($,{prop:"charCount",label:"字符数",width:"100",align:"center"},{default:o(({row:d})=>[l(i,{type:d.isExceeded?"danger":"success"},{default:o(()=>[a(b(d.charCount),1)]),_:2},1032,["type"])]),_:1}),l($,{label:"状态",width:"120",align:"center"},{default:o(({row:d})=>[d.isExceeded?(c(),g(M,{key:0,type:"danger"},{default:o(()=>[a(" 超出 "+b(d.exceededChars)+" 字符 ",1)]),_:2},1024)):(c(),g(M,{key:1,type:"success"},{default:o(()=>[...e[28]||(e[28]=[a("正常",-1)])]),_:1}))]),_:1}),l($,{label:"操作",width:"100",align:"center"},{default:o(({row:d})=>[C.value!==d.index?(c(),g(k,{key:0,link:"",type:"primary",onClick:p=>O(d)},{default:o(()=>[...e[29]||(e[29]=[a(" 编辑 ",-1)])]),_:1},8,["onClick"])):(c(),g(k,{key:1,link:"",type:"success",onClick:p=>G(d)},{default:o(()=>[...e[30]||(e[30]=[a(" 保存 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):F("",!0)])}}},$e=ne(ke,[["__scopeId","data-v-41087760"]]);export{$e as default};
